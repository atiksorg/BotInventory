<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Constructor</title>
    <head>
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
:root {
    /* Color Variables */
    --primary-color: #4a90e2;
    --secondary-color: #f5f5f5;
    --border-color: #ddd;
    --dark-bg-primary: #2e2e2e;
    --dark-bg-secondary: #3e3e3e;

    /* Size Variables */
    --slot-size: 70px;
    --item-size: 60px;
}

/* Reset and Base Styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f2f5;
    padding: 20px;
    transition: background-color 0.3s, color 0.3s;
}

/* Layout */
.container {
    display: flex;
    gap: 30px;
    max-width: 1200px;
    min-width: 800px;
    margin: 0 auto;
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow-x: auto;
}

.character-area {
    width: 500px;
    height: 600px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    position: relative;
    background: linear-gradient(to bottom, #e6f3ff, #ffffff);
}

.inventory {
    width: 350px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    background-color: var(--secondary-color);
    height: 600px;
    overflow-y: auto; 
}

/* Inventory Categories */
.category {
    margin-bottom: 25px;
    background-color: white;
    padding: 10px;
    border-radius: 8px;
}

.category-title {
    font-weight: bold;
    margin-bottom: 15px;
    color: var(--primary-color);
    padding-bottom: 5px;
    border-bottom: 2px solid var(--border-color);
}

/* Items and Slots */
.item {
    width: var(--item-size);
    height: var(--item-size);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    margin: 5px;
    background-color: white;
    cursor: move;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s, box-shadow 0.2s;
    user-select: none;
}

.slot {
    width: var(--slot-size);
    height: var(--slot-size);
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255,255,255,0.5);
    transition: background-color 0.3s;
}

.equipped {
    position: absolute;
    z-index: 2;
    transition: all 0.3s ease;
}

/* Interactive States */
.item:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.item:active {
    transform: scale(0.95);
}

.slot.highlight {
    background-color: rgba(74, 144, 226, 0.2);
    border-color: var(--primary-color);
}

/* Controls */
.controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}

.button {
    padding: 8px 16px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.button:hover {
    background-color: #357abd;
}

/* Tooltip */
.tooltip {
    position: fixed;
    background-color: black;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
}

/* Dark Mode */
body.dark-mode {
    background-color: #1e1e1e;
    color: #f5f5f5;
}

body.dark-mode .container {
    background-color: var(--dark-bg-primary);
}

body.dark-mode .inventory, 
body.dark-mode .character-area {
    background-color: var(--dark-bg-secondary);
    border-color: #555;
}

body.dark-mode .item {
    background-color: #4e4e4e;
}

body.dark-mode .slot {
    background-color: rgba(255, 255, 255, 0.1);
}

body.dark-mode .button {
    background-color: #357abd;
}

body.dark-mode .character-area {
    background: linear-gradient(to bottom, #3e3e3e, #2e2e2e);
}

body.dark-mode .category {
    background-color: #4e4e4e;
}



.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

body.dark-mode .modal {
    background-color: rgba(0,0,0,0.8);
}

body.dark-mode .modal-content {
    background-color: var(--dark-bg-secondary);
    color: #f5f5f5;
}


</style>
</head>
<body>
    <div class="container">
        <div class="character-area" id="character-area"></div>
        
        <div class="inventory" id="inventory">
            <!-- Inventory categories will be dynamically populated -->
        </div>
        
        <div class="controls">
            <button class="button" id="toggle-theme-btn">Toggle Theme</button>
            <button class="button" id="reset-btn">Reset</button>
        </div>
    </div>
    
<div class="modal fade" id="item-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Item Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" class="form-control mb-3" id="item-text" placeholder="Text input">
                <select class="form-select mb-3" id="item-select">
                    <option value="option1">Option 1</option>
                    <option value="option2">Option 2</option>
                </select>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="item-checkbox">
                    <label class="form-check-label" for="item-checkbox">Checkbox</label>
                </div>
                <textarea class="form-control mb-3" id="item-textarea" placeholder="Textarea"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-btn">Save</button>
            </div>
        </div>
    </div>
</div>

    <script>
// inventory-data.js
const inventoryData = [
    {
        category: 'Голова',
        items: [
            { emoji: '🎩', type: 'head', tooltip: 'Шляпа' },
            { emoji: '👓', type: 'head', tooltip: 'Очки' },
            { emoji: '😷', type: 'head', tooltip: 'Маска' },
            { emoji: '⛑️', type: 'head', tooltip: 'Каска' },
            { emoji: '🧢', type: 'head', tooltip: 'Кепка' },
            { emoji: '🪖', type: 'head', tooltip: 'Шлем' },
            { emoji: '👑', type: 'head', tooltip: 'Корона' },
            { emoji: '🎓', type: 'head', tooltip: 'Берет' }
        ]
    },
    {
        category: 'Туловище',
        items: [
            { emoji: '👕', type: 'torso', tooltip: 'Рубашка' },
            { emoji: '🧥', type: 'torso', tooltip: 'Куртка' },
            { emoji: '🧥', type: 'torso', tooltip: 'Пальто' },
            { emoji: '🧶', type: 'torso', tooltip: 'Свитер' },
            { emoji: '👚', type: 'torso', tooltip: 'Футболка' },
            { emoji: '🦺', type: 'torso', tooltip: 'Жилет' },
            { emoji: '🧥', type: 'torso', tooltip: 'Пиджак' }
        ]
    },
    {
        category: 'Ноги',
        items: [
            { emoji: '👖', type: 'legs', tooltip: 'Штаны' },
            { emoji: '👞', type: 'legs', tooltip: 'Обувь' },
            { emoji: '🥾', type: 'legs', tooltip: 'Ботинки' },
            { emoji: '🩳', type: 'legs', tooltip: 'Шорты' },
            { emoji: '👗', type: 'legs', tooltip: 'Юбка' },
            { emoji: '👢', type: 'legs', tooltip: 'Сапоги' },
            { emoji: '👟', type: 'legs', tooltip: 'Кроссовки' }
        ]
    }
];

// slot-config.js
const slotConfig = [
    { 
        zone: 'head', 
        positions: [
            { top: '5%', left: '20%' },
            { top: '5%', left: '50%' },
            { top: '5%', left: '80%' }
        ]
    },
    { 
        zone: 'torso', 
        positions: [
            { top: '30%', left: '10%' },
            { top: '30%', left: '30%' },
            { top: '30%', left: '50%' },
            { top: '30%', left: '70%' },
            { top: '45%', left: '30%' },
            { top: '45%', left: '50%' }
        ]
    },
    { 
        zone: 'legs', 
        positions: [
            { top: '60%', left: '40%' },
            { top: '60%', left: '60%' }
        ]
    }
];


class CharacterConstructor {
    constructor() {
        this.initializeDOM();
        this.createTooltip();
        this.generateSlots();
        this.populateInventory();
        this.initializeEventListeners();
    }

    initializeDOM() {
        this.inventory = document.getElementById('inventory');
        this.characterArea = document.getElementById('character-area');
        this.toggleThemeBtn = document.getElementById('toggle-theme-btn');
        this.resetBtn = document.getElementById('reset-btn');
        this.equippedItems = new Map();
    }

    createTooltip() {
        this.tooltip = document.createElement('div');
        this.tooltip.className = 'tooltip';
        document.body.appendChild(this.tooltip);
    }

    populateInventory() {
        inventoryData.forEach(category => {
            const categoryElement = document.createElement('div');
            categoryElement.className = 'category';

            const titleElement = document.createElement('div');
            titleElement.className = 'category-title';
            titleElement.textContent = category.category;
            titleElement.draggable = false;
            categoryElement.appendChild(titleElement);

            category.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.draggable = true;
                itemElement.dataset.type = item.type;
                itemElement.dataset.tooltip = item.tooltip;
                itemElement.textContent = item.emoji;
                categoryElement.appendChild(itemElement);
                itemElement.addEventListener('dblclick', this.showItemModal.bind(this, itemElement));
            });

            this.inventory.appendChild(categoryElement);
        });
 
    }

    generateSlots() {
        this.slots = slotConfig.flatMap(config => 
            config.positions.map(pos => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.dataset.zone = config.zone;
                slot.style.top = pos.top;
                slot.style.left = pos.left;
                this.characterArea.appendChild(slot);
                return slot;
            })
        );
        
        
        
    }

    initializeEventListeners() {
        this.inventory.addEventListener('dragstart', this.handleDragStart.bind(this));
        this.characterArea.addEventListener('dragover', this.handleDragOver.bind(this));
        this.characterArea.addEventListener('drop', this.handleDrop.bind(this));
        this.inventory.addEventListener('mousemove', this.handleTooltip.bind(this));
        document.addEventListener('mouseleave', () => this.hideTooltip());
        
        this.toggleThemeBtn.addEventListener('click', this.toggleTheme.bind(this));
        this.resetBtn.addEventListener('click', this.resetCharacter.bind(this));
    }

    handleDragStart(e) {
        const item = e.target.closest('.item');
        if (item) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
                type: item.dataset.type,
                emoji: item.textContent
            }));
            this.highlightValidSlots(item.dataset.type);
        }
    }

    handleDragOver(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        if (slot) slot.classList.add('highlight');
    }

    handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        if (!slot) return;

        try {
            const itemData = JSON.parse(e.dataTransfer.getData('text/plain'));
            if (slot.dataset.zone === itemData.type) {
                this.equipItem(itemData, slot);
            }
        } catch (err) {
            console.error('Drop error:', err);
        }

        this.highlightValidSlots(null);
    }

    equipItem(itemData, slot) {
        if (this.equippedItems.has(slot)) {
            this.unequipItem(slot);
        }

        const newItem = this.createEquippedItem(itemData, slot);
        this.equippedItems.set(slot, newItem);
    }

    createEquippedItem(itemData, slot) {
        const newItem = document.createElement('div');
        newItem.className = 'item equipped';
        newItem.textContent = itemData.emoji;
        newItem.dataset.type = itemData.type;
        newItem.style.top = slot.style.top;
        newItem.style.left = slot.style.left;
        
        newItem.addEventListener('click', () => this.unequipItem(slot));
        this.characterArea.appendChild(newItem);
        return newItem;
    }

    unequipItem(slot) {
        if (this.equippedItems.has(slot)) {
            const item = this.equippedItems.get(slot);
            item.remove(); // Remove the item from the DOM
            this.equippedItems.delete(slot);
        }
    }

    findCategoryForItem(type) {
        const categories = this.inventory.querySelectorAll('.category');
        for (let category of categories) {
            const matchingItem = Array.from(category.querySelectorAll('.item'))
                .find(item => item.dataset.type === type);
            if (matchingItem) return category;
        }
        return this.inventory; // Fallback
    }

    handleTooltip(e) {
        const item = e.target.closest('.item');
        if (!item || !item.dataset.tooltip) {
            this.hideTooltip();
            return;
        }

        this.tooltip.innerHTML = this.generateTooltipContent(item);
        this.tooltip.style.opacity = '1';

        const tooltipRect = this.tooltip.getBoundingClientRect();
        let left = e.pageX + 10;
        let top = e.pageY + 10;

        if (left + tooltipRect.width > window.innerWidth) {
            left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top + tooltipRect.height > window.innerHeight) {
            top = window.innerHeight - tooltipRect.height - 10;
        }

        this.tooltip.style.left = `${left}px`;
        this.tooltip.style.top = `${top}px`;
    }

    generateTooltipContent(item) {
        return `<div class="tooltip-title">${item.dataset.tooltip}</div>`;
    }

    hideTooltip() {
        this.tooltip.style.opacity = '0';
    }

    highlightValidSlots(type) {
        this.slots.forEach(slot => {
            slot.classList.toggle('highlight', type ? slot.dataset.zone === type : false);
        });
    }

    resetCharacter() {
        this.equippedItems.forEach((item, slot) => {
            const category = this.findCategoryForItem(item.dataset.type);
            category.appendChild(item);
            item.classList.remove('equipped');
            item.style.position = '';
            item.style.top = '';
            item.style.left = '';
        });
        this.equippedItems.clear();
    }

    toggleTheme() {
        document.body.classList.toggle('dark-mode');
    }

    static initialize() {
        return new CharacterConstructor();
    }
    
    
    
    showItemModal(item) {
    this.hideTooltip();
    const modal = document.getElementById('item-modal');
    // Use Bootstrap's modal show method
    new bootstrap.Modal(modal).show();
    this.resetModal();
}

    resetModal() {
        document.getElementById('item-text').value = '';
        document.getElementById('item-select').value = 'option1';
        document.getElementById('item-checkbox').checked = false;
        document.getElementById('item-textarea').value = '';
    }
    
    
}

// Initialize the Character Constructor when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', CharacterConstructor.initialize);


document.getElementById('save-btn').addEventListener('click', () => {
    const text = document.getElementById('item-text').value;
    const select = document.getElementById('item-select').value;
    const checkbox = document.getElementById('item-checkbox').checked;
    const textarea = document.getElementById('item-textarea').value;

    // Handle the data as needed
    console.log('Text:', text);
    console.log('Select:', select);
    console.log('Checkbox:', checkbox);
    console.log('Textarea:', textarea);

    // Use Bootstrap's modal hide method
    const modal = document.getElementById('item-modal');
    new bootstrap.Modal(modal).hide();
});

</script>
</body>
</html>
