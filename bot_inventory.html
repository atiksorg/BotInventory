<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Constructor</title>
    <head>
  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
:root {
    /* Color Variables */
    --primary-color: #999;
    --secondary-color: #f5f5f5;
    --border-color: #ddd;
    --dark-bg-primary: #343a40;
    --dark-bg-secondary: #424E5B;
    --dark-bg-border: #6c757d;
    --dark-bg-border-light: #ccc;

    /* Size Variables */
    --slot-size: 70px;
    --item-size: 60px;
}

/* Reset and Base Styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f2f5;
    padding: 20px;
    transition: background-color 0.3s, color 0.3s;
}

/* Layout */
.container {
    display: flex;
    gap: 30px;
    max-width: 1200px;
    min-width: 800px;
    margin: 0 auto;
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    //box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow-x: auto;
}

.character-area {
    width: 500px;
    height: 600px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    position: relative;
    background: linear-gradient(to bottom, #e6f3ff, #ffffff);
    background-image: url('https://wl.atiks.org/wp-content/uploads/2024/11/bot_inventory.png');
    background-size: cover;
    background-position: center;
    overflow: hidden;
}

.inventory {
    width: 350px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    background-color: var(--secondary-color);
    height: 600px;
    overflow-y: auto; 
}

/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
.inventory::-webkit-scrollbar {
    width: 4px;
}

.inventory::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.inventory::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 2px;
}

.inventory::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Inventory Categories */
.category {
    margin-bottom: 25px;
    background-color: white;
    padding: 10px;
    border-radius: 8px;
}

.category-title {
    font-weight: bold;
    margin-bottom: 15px;
    color: var(--primary-color);
    padding-bottom: 5px;
    border-bottom: 2px solid var(--border-color);
}

/* Items and Slots */
.item {
    width: var(--item-size);
    height: var(--item-size);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    margin: 5px;
    background-color: white;
    cursor: move;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s, box-shadow 0.2s;
    user-select: none;
}

.slot {
    width: var(--slot-size);
    height: var(--slot-size);
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255,255,255,0.2);
    transition: background-color 0.3s;
}

.equipped {
    position: absolute;
    z-index: 2;
    transition: all 0.3s ease;
}

/* Interactive States */
.item:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.item:active {
    transform: scale(0.95);
}

.slot.highlight {
    background-color: rgba(255, 255, 255, 0.5);
    border-color: var(--primary-color);
}

/* Controls */
.controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}

.button {
    padding: 8px 16px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.button:hover {
    background-color: #357abd;
}

/* Tooltip */
.tooltip {
    position: absolute;
    display: none;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1000;
    background-color: #333;
    color: #fff;
    padding: 5px;
    border-radius: 3px;
    font-size: 14px;
}


/* Dark Mode */
body.dark-mode {
    background-color: var(--dark-bg-primary);
    color: #f5f5f5;
}

body.dark-mode .container {
    background-color: var(--dark-bg-primary);
}

body.dark-mode .inventory, 
body.dark-mode .character-area {
    background-color: var(--dark-bg-secondary);
    border-color: var(--dark-bg-border);
}

body.dark-mode .item {
    background-color: var(--dark-bg-secondary);
    border: 2px solid var(--dark-bg-border);
}

body.dark-mode .slot {
    background-color: rgba(255, 255, 255, 0.1);
    border: 2px dashed rgba(255,255,255,0.2);
}

body.dark-mode .slot.highlight {
    border-color: var(--dark-bg-border-light);
}

body.dark-mode .button {
    background-color: var(--dark-bg-primary);
}

body.dark-mode .btn-close {
    background-color: var(--dark-bg-border);
}

body.dark-mode .character-area {
    background: linear-gradient(to bottom, #3e3e3e, #2e2e2e);
    background-image: url('https://wl.atiks.org/wp-content/uploads/2024/11/bot_inventory.png');
    background-size: cover;
    background-position: center;
    overflow: hidden;
}

body.dark-mode .category {
    background-color: var(--dark-bg-secondary);
}

body.dark-mode .category-title {
    border-bottom: 2px solid var(--dark-bg-border);
}




.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.modal-content input,
.modal-content select,
.modal-content textarea {
    font-size:1.0rem;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

body.dark-mode .modal {
    background-color: rgba(0,0,0,0.8);
}

body.dark-mode .modal-content {
    background-color: var(--dark-bg-secondary);
    color: #f5f5f5;
}

body.dark-mode .modal-content input,
body.dark-mode .modal-content select,
body.dark-mode .modal-content textarea {
    background-color: var(--dark-bg-secondary);
    color: #f5f5f5;
    border: 1px solid var(--dark-bg-border);
}

body.dark-mode .modal-content input::placeholder,
body.dark-mode .modal-content textarea::placeholder {
    color: #999; /* Light gray for better readability */
}

body.dark-mode .modal-content label {
    color: #f5f5f5;
}

body.dark-mode .modal-content .btn {
    color: #fff;
    /* Adjust background colors as necessary */
}

body.dark-mode .modal-content .btn-close {
    color: #ccc;
}

body.dark-mode .modal-header {
    border-bottom: var(--bs-modal-header-border-width) solid var(--dark-bg-border);
}

body.dark-mode .modal-footer {
    border-top: var(--bs-modal-footer-border-width) solid var(--dark-bg-border);
}


</style>
</head>
<body>
    <div class="container">
        <div class="character-area" id="character-area"></div>
        
        <div class="inventory" id="inventory">
            <!-- Inventory categories will be dynamically populated -->
        </div>
        
        <div class="controls">
            <button class="button" id="toggle-theme-btn"><i class="fas fa-sun"></i></button>
        <button class="button" id="reset-btn"><i class="fas fa-undo"></i></button>
        </div>
    </div>
    
<div class="modal fade" id="item-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel"></h5> <!-- Removed static text -->
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
            <div class="modal-body">
                <input type="text" class="form-control mb-3" id="item-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç">
                <select class="form-select mb-3" id="item-select">
                    <option value="option1">–û–ø—Ü–∏—è 1</option>
                    <option value="option2">–û–ø—Ü–∏—è 2</option>
                </select>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="item-checkbox">
                    <label class="form-check-label" for="item-checkbox">–ß–µ–∫–±–æ–∫—Å</label>
                </div>
                <textarea class="form-control mb-3" id="item-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary small" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
              <button type="button" class="btn btn-primary small" id="save-btn" data-bs-dismiss="modal">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button type="button" class="btn btn-danger small" id="delete-btn" data-bs-dismiss="modal">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
    </div>
</div>

    <script>
// inventory-data.js
const inventoryData = [
    {
        category: '–ì–æ–ª–æ–≤–∞',
        items: [
            { emoji: 'üé©', type: 'head', tooltip: '–®–ª—è–ø–∞' },
            { emoji: 'üëì', type: 'head', tooltip: '–û—á–∫–∏' },
            { emoji: 'üò∑', type: 'head', tooltip: '–ú–∞—Å–∫–∞' },
            { emoji: '‚õëÔ∏è', type: 'head', tooltip: '–ö–∞—Å–∫–∞' },
            { emoji: 'üß¢', type: 'head', tooltip: '–ö–µ–ø–∫–∞' },
            { emoji: 'ü™ñ', type: 'head', tooltip: '–®–ª–µ–º' },
            { emoji: 'üëë', type: 'head', tooltip: '–ö–æ—Ä–æ–Ω–∞' },
            { emoji: 'üéì', type: 'head', tooltip: '–ë–µ—Ä–µ—Ç' }
        ]
    },
    {
        category: '–¢—É–ª–æ–≤–∏—â–µ',
        items: [
            { emoji: 'üëï', type: 'torso', tooltip: '–†—É–±–∞—à–∫–∞' },
            { emoji: 'üß•', type: 'torso', tooltip: '–ö—É—Ä—Ç–∫–∞' },
            { emoji: 'üß•', type: 'torso', tooltip: '–ü–∞–ª—å—Ç–æ' },
            { emoji: 'üß∂', type: 'torso', tooltip: '–°–≤–∏—Ç–µ—Ä' },
            { emoji: 'üëö', type: 'torso', tooltip: '–§—É—Ç–±–æ–ª–∫–∞' },
            { emoji: 'ü¶∫', type: 'torso', tooltip: '–ñ–∏–ª–µ—Ç' },
            { emoji: 'üß•', type: 'torso', tooltip: '–ü–∏–¥–∂–∞–∫' }
        ]
    },
    {
        category: '–ù–æ–≥–∏',
        items: [
            { emoji: 'üëñ', type: 'legs', tooltip: '–®—Ç–∞–Ω—ã' },
            { emoji: 'üëû', type: 'legs', tooltip: '–û–±—É–≤—å' },
            { emoji: 'ü•æ', type: 'legs', tooltip: '–ë–æ—Ç–∏–Ω–∫–∏' },
            { emoji: 'ü©≥', type: 'legs', tooltip: '–®–æ—Ä—Ç—ã' },
            { emoji: 'üëó', type: 'legs', tooltip: '–Æ–±–∫–∞' },
            { emoji: 'üë¢', type: 'legs', tooltip: '–°–∞–ø–æ–≥–∏' },
            { emoji: 'üëü', type: 'legs', tooltip: '–ö—Ä–æ—Å—Å–æ–≤–∫–∏' }
        ]
    }
];

// slot-config.js
const slotConfig = [
    { 
        zone: 'head', 
        positions: [
            { id: 'head-1', top: '5%', left: '4%' },
            { id: 'head-2', top: '5%', left: '23%' },
            { id: 'head-3', top: '5%', left: '60%' },
            { id: 'head-4', top: '5%', left: '80%' },
        ]
    },
    { 
        zone: 'torso', 
        positions: [
            { id: 'torso-1', top: '25%', left: '10%' },
            { id: 'torso-2', top: '25%', left: '75%' },
            { id: 'torso-3', top: '40%', left: '10%' },
            { id: 'torso-4', top: '40%', left: '75%' },
            { id: 'torso-5', top: '55%', left: '10%' },
            { id: 'torso-6', top: '55%', left: '75%' },
        ]
    },
    { 
        zone: 'legs', 
        positions: [
            { id: 'legs-1', bottom: '5%', left: '4%' },
            { id: 'legs-2', bottom: '5%', left: '23%' },
            { id: 'legs-3', bottom: '5%', left: '60%' },
            { id: 'legs-4', bottom: '5%', left: '80%' }
        ]
    }
];

class CharacterConstructor {
    constructor() {
        this.initializeDOM();
        this.createTooltip();
        this.generateSlots();
        this.populateInventory();
        this.initializeEventListeners();
    }

    initializeDOM() {
        this.inventory = document.getElementById('inventory');
        this.characterArea = document.getElementById('character-area');
        this.toggleThemeBtn = document.getElementById('toggle-theme-btn');
        this.resetBtn = document.getElementById('reset-btn');
        this.equippedItems = new Map();

        // –í–∫–ª—é—á–∞–µ–º —Ç–µ–º–Ω—É—é —Ç–µ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.body.classList.add('dark-mode');
    }

    createTooltip() {
        this.tooltip = document.createElement('div');
        this.tooltip.className = 'tooltip';
        document.body.appendChild(this.tooltip);
    }

    populateInventory() {
        inventoryData.forEach(category => {
            const categoryElement = document.createElement('div');
            categoryElement.className = 'category';

            const titleElement = document.createElement('div');
            titleElement.className = 'category-title';
            titleElement.textContent = category.category;
            titleElement.draggable = false;
            categoryElement.appendChild(titleElement);

            category.items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                itemElement.draggable = true;
                itemElement.dataset.type = item.type;
                itemElement.dataset.tooltip = item.tooltip;
                itemElement.textContent = item.emoji;
                categoryElement.appendChild(itemElement);
                itemElement.addEventListener('dblclick', this.showItemModal.bind(this, itemElement));
            });

            this.inventory.appendChild(categoryElement);
        });
    }

    generateSlots() {
        this.slots = slotConfig.flatMap(config => 
            config.positions.map(pos => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.dataset.zone = config.zone;
                slot.dataset.id = pos.id; // Use the unique ID
                slot.style.top = pos.bottom ? '' : pos.top;
                slot.style.bottom = pos.bottom ? pos.bottom : '';
                slot.style.left = pos.left;
                this.characterArea.appendChild(slot);
                return slot;
            })
        );
    }

    initializeEventListeners() {
        this.inventory.addEventListener('dragstart', this.handleDragStart.bind(this));
        this.characterArea.addEventListener('dragover', this.handleDragOver.bind(this));
        this.characterArea.addEventListener('drop', this.handleDrop.bind(this));
        
        this.toggleThemeBtn.addEventListener('click', this.toggleTheme.bind(this));
        this.resetBtn.addEventListener('click', this.resetCharacter.bind(this));
        this.deleteBtn = document.getElementById('delete-btn');
        this.deleteBtn.addEventListener('click', () => {
            if (this.currentEquippedItem) {
                this.deleteItem(this.currentEquippedItem);
                this.currentEquippedItem = null;
            } else {
                console.log('No current equipped item to delete');
            }
        });
        this.resetBtn.addEventListener('click', () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –±–ª–æ–∫–∏?')) {
                this.resetCharacter();
            }
        });
    }
    
    
    deleteItem(equippedItem) {
        const slotId = equippedItem.slotId;
        const equippedData = this.equippedItems.get(slotId);
        if (equippedData) {
            equippedItem.remove(); // Remove the equipped item from the character area
            this.equippedItems.delete(slotId);
        } else {
            console.log('Equipped data not found for slot id:', slotId);
        }
    }


    handleDragStart(e) {
        const item = e.target.closest('.item');
        if (item) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
                type: item.dataset.type,
                emoji: item.textContent,
                tooltip: item.dataset.tooltip
            }));
            this.highlightValidSlots(item.dataset.type);
        }
    }

    handleDragOver(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        if (slot) slot.classList.add('highlight');
    }

    handleDrop(e) {
        e.preventDefault();
        const slot = e.target.closest('.slot');
        if (!slot) return;

        try {
            const itemData = JSON.parse(e.dataTransfer.getData('text/plain'));
            if (slot.dataset.zone === itemData.type) {
                this.equipItem(itemData, slot);
            }
        } catch (err) {
            console.error('Drop error:', err);
        }

        this.highlightValidSlots(null);
    }

    equipItem(itemData, slot) {
        if (this.equippedItems.has(slot.dataset.id)) {
            this.unequipItem(slot);
        }

        const newItem = this.createEquippedItem(itemData, slot);
        newItem.slotId = slot.dataset.id;
        newItem.addEventListener('click', () => this.showItemModal(newItem));
        this.equippedItems.set(slot.dataset.id, { newItem: newItem });
    }

    createEquippedItem(itemData, slot) {
        const newItem = document.createElement('div');
        newItem.className = 'item equipped';
        newItem.textContent = itemData.emoji;
        newItem.dataset.type = itemData.type;
        newItem.dataset.tooltip = itemData.tooltip;
        //newItem.style.top = slot.style.top;
        if (slot.style.top) {
          newItem.style.top = slot.style.top;
        } else if (slot.style.bottom) {
          newItem.style.bottom = slot.style.bottom;
        }
        newItem.style.left = slot.style.left;
        newItem.slot = slot; // Set the slot reference on the newItem
        this.characterArea.appendChild(newItem);
        console.log('Created equipped item:', newItem, 'in slot:', slot); // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        return newItem;
    }

    findCategoryForItem(type) {
        const categories = this.inventory.querySelectorAll('.category');
        for (let category of categories) {
            const matchingItem = Array.from(category.querySelectorAll('.item'))
                .find(item => item.dataset.type === type);
            if (matchingItem) return category;
        }
        return this.inventory; // Fallback
    }

    generateTooltipContent(item) {
    	console.log(item.dataset.tooltip);
        return `<div class="tooltip-title">${item.dataset.tooltip}</div>`;
    }

    hideTooltip() {
        this.tooltip.style.opacity = '0';
    }

    highlightValidSlots(type) {
        this.slots.forEach(slot => {
            slot.classList.toggle('highlight', type ? slot.dataset.zone === type : false);
        });
    }

    resetCharacter() {
        this.equippedItems.forEach((itemData, slotId) => {
            const item = itemData.newItem;
            item.remove(); // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        });
        this.equippedItems.clear();
        this.slots.forEach(slot => slot.classList.remove('highlight'));
    }

    toggleTheme() {
        const body = document.body;
        const toggleBtn = document.getElementById('toggle-theme-btn');
        const isDarkMode = body.classList.toggle('dark-mode');
        if (isDarkMode) {
          toggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
          toggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        }
      }

    static initialize() {
        return new CharacterConstructor();
    }

    showItemModal(equippedItem) {
        this.hideTooltip();
        const modal = new bootstrap.Modal(document.getElementById('item-modal'));
        modal.show();
        this.resetModal();
        this.currentEquippedItem = equippedItem;

        // Set the modal title to the item's tooltip
        const modalTitle = document.getElementById('exampleModalLabel');
        modalTitle.textContent = equippedItem.dataset.tooltip;
    }
    
    generateTooltipContent(item) {
        return `<div class="tooltip-title">${item.dataset.tooltip}</div>`;
    }

    resetModal() {
        document.getElementById('item-text').value = '';
        document.getElementById('item-select').value = 'option1';
        document.getElementById('item-checkbox').checked = false;
        document.getElementById('item-textarea').value = '';
    }
}

// Initialize the Character Constructor when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', CharacterConstructor.initialize);

document.getElementById('save-btn').addEventListener('click', () => {
    const text = document.getElementById('item-text').value;
    const select = document.getElementById('item-select').value;
    const checkbox = document.getElementById('item-checkbox').checked;
    const textarea = document.getElementById('item-textarea').value;

    // Handle the data as needed
    console.log('Text:', text);
    console.log('Select:', select);
    console.log('Checkbox:', checkbox);
    console.log('Textarea:', textarea);

    // Use Bootstrap's modal hide method
    const modal = new bootstrap.Modal(document.getElementById('item-modal'));
    modal.hide();
});


class TooltipHandler {
    constructor() {
        this.tooltip = document.createElement('div');
        this.tooltip.className = 'tooltip';
        document.body.appendChild(this.tooltip);

        this.tooltip.style.position = 'absolute';
        this.tooltip.style.display = 'none';
        this.tooltip.style.opacity = '0';
        this.tooltip.style.transition = 'opacity 0.3s';
        this.tooltip.style.zIndex = '1000';
        this.tooltip.style.backgroundColor = '#333';
        this.tooltip.style.color = '#fff';
        this.tooltip.style.padding = '5px';
        this.tooltip.style.borderRadius = '3px';
        this.tooltip.style.fontSize = '14px';

        document.addEventListener('mousemove', this.handleTooltip.bind(this));
    }

    handleTooltip(e) {
        const item = e.target.closest('[data-tooltip]');
        if (!item) {
            this.hideTooltip();
            return;
        }

        this.tooltip.innerHTML = item.dataset.tooltip;
        this.tooltip.style.display = 'block';
        this.tooltip.style.opacity = '1';

        const tooltipRect = this.tooltip.getBoundingClientRect();
        let left = e.pageX + 10;
        let top = e.pageY + 10;

        if (left + tooltipRect.width > window.innerWidth) {
            left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top + tooltipRect.height > window.innerHeight) {
            top = window.innerHeight - tooltipRect.height - 10;
        }

        this.tooltip.style.left = `${left}px`;
        this.tooltip.style.top = `${top}px`;
    }

    hideTooltip() {
        this.tooltip.style.display = 'none';
        this.tooltip.style.opacity = '0';
    }
}

new TooltipHandler();

</script>
</body>
</html>
